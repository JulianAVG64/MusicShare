# ğŸ—ï¸ Diagrama de Arquitectura MusicShare

## Arquitectura Completa

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                          INTERNET / CLIENTES                      â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
                             â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  AWS/GCP/Azure          â”‚
                â”‚  LoadBalancer PÃºblico   â”‚
                â”‚  (IP PÃºblica Externa)   â”‚
                â”‚  Puertos: 80, 443       â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                                        â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   FRONTEND        â”‚            â”‚  NGINX INGRESS        â”‚
    â”‚   LoadBalancer    â”‚            â”‚  Controller           â”‚
    â”‚                   â”‚            â”‚                       â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚ Frontend    â”‚  â”‚            â”‚  â”‚ NGINX Pods (2)  â”‚  â”‚
    â”‚  â”‚ Pod 1       â”‚  â”‚            â”‚  â”‚                 â”‚  â”‚
    â”‚  â”‚ (React)     â”‚  â”‚            â”‚  â”‚ Namespaces:     â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚            â”‚  â”‚ ingress-nginx   â”‚  â”‚
    â”‚                   â”‚            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚            â”‚                       â”‚
    â”‚  â”‚ Frontend    â”‚  â”‚            â”‚  Puertos:             â”‚
    â”‚  â”‚ Pod 2       â”‚  â”‚            â”‚  - 80 (HTTP)          â”‚
    â”‚  â”‚ (React)     â”‚  â”‚            â”‚  - 443 (HTTPS)        â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚            â”‚  - 10254 (Metrics)    â”‚
    â”‚                   â”‚            â”‚                       â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚            â”‚  Funciones:           â”‚
    â”‚  â”‚ Frontend    â”‚  â”‚            â”‚  â€¢ API Gateway        â”‚
    â”‚  â”‚ Pod 3       â”‚  â”‚            â”‚  â€¢ Route matching     â”‚
    â”‚  â”‚ (React)     â”‚  â”‚            â”‚  â€¢ TLS termination    â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚            â”‚  â€¢ Load balancing     â”‚
    â”‚                   â”‚            â”‚  â€¢ Rate limiting      â”‚
    â”‚  Namespace:       â”‚            â”‚  â€¢ CORS               â”‚
    â”‚  musicshare       â”‚            â”‚                       â”‚
    â”‚                   â”‚            â”‚  Service Type:        â”‚
    â”‚  Type: LB         â”‚            â”‚  LoadBalancer         â”‚
    â”‚                   â”‚            â”‚                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–²                                      â”‚
         â”‚ (Acceso directo)         (API Gateway - enrutamiento)
         â”‚                                      â”‚
         â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                          â”‚                                    â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  â”‚ /              â”‚ â”‚ /api/users â”‚ â”‚ /api/music â”‚ â”‚ /api/social    â”‚
         â”‚  â”‚ (Frontend Home)â”‚ â”‚ UserServiceâ”‚ â”‚Music       â”‚ â”‚SocialService   â”‚
         â”‚  â”‚                â”‚ â”‚ :8002      â”‚ â”‚Service     â”‚ â”‚:8083 (Java)    â”‚
         â”‚  â”‚                â”‚ â”‚ :8002      â”‚ â”‚:8081 (Go)  â”‚ â”‚                â”‚
         â”‚  â”‚                â”‚ â”‚ 2-6 replic â”‚ â”‚2-6 replic  â”‚ â”‚2-5 replicas    â”‚
         â”‚  â”‚                â”‚ â”‚            â”‚ â”‚            â”‚ â”‚HPA 55% CPU     â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚  â–²
         â”‚  â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                 â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚ LoadBalancer IP  â”‚   â”‚
    â”‚ (PÃºblica)        â”‚   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                    â”‚WebSocket /wsâ”‚
                    â”‚Notificationsâ”‚
                    â”‚:8082        â”‚
                    â”‚2-6 replicas â”‚
                    â”‚HPA 50% CPU  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     DATABASES (Persistent)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  PostgreSQL    â”‚  â”‚    MongoDB      â”‚  â”‚  Redis (Cache)   â”‚  â”‚
â”‚  â”‚  (Relational)  â”‚  â”‚   (NoSQL/JSON)  â”‚  â”‚  (Optional)      â”‚  â”‚
â”‚  â”‚                â”‚  â”‚                 â”‚  â”‚                  â”‚  â”‚
â”‚  â”‚ â€¢ Users        â”‚  â”‚ â€¢ Music metadataâ”‚  â”‚ â€¢ Sessions       â”‚  â”‚
â”‚  â”‚ â€¢ Profiles     â”‚  â”‚ â€¢ Playlists     â”‚  â”‚ â€¢ Cache datos    â”‚  â”‚
â”‚  â”‚ â€¢ Follows      â”‚  â”‚ â€¢ Songs info    â”‚  â”‚                  â”‚  â”‚
â”‚  â”‚ â€¢ Social stuff â”‚  â”‚ â€¢ Indexes       â”‚  â”‚                  â”‚  â”‚
â”‚  â”‚                â”‚  â”‚                 â”‚  â”‚                  â”‚  â”‚
â”‚  â”‚ Persistent     â”‚  â”‚ Persistent      â”‚  â”‚ Ephemeral (ok)   â”‚  â”‚
â”‚  â”‚ Volume: 50GB   â”‚  â”‚ Volume: 100GB   â”‚  â”‚                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Flujo de Datos

### 1. Acceso al Frontend (Directo)

```
Cliente Browser
        â”‚
        â–¼
    [GET /]
        â”‚
        â–¼
LoadBalancer IP PÃºblica
        â”‚
        â–¼
Frontend Service (ClusterIP:80)
        â”‚
        â–¼
Frontend Pods (React App)
        â”‚
        â–¼
HTML/CSS/JS + API Calls
```

### 2. Acceso a API (A travÃ©s de NGINX)

```
Cliente JavaScript / Mobile App
        â”‚
        â–¼
    [GET /api/users/me]
        â”‚
        â–¼
NGINX Ingress IP (PÃºblica)
        â”‚
        â–¼
NGINX Controller Pods
        â”‚
        â–¼
Route Matching: /api/users â†’ userservice
        â”‚
        â–¼
Rewrite: /api/users/me â†’ /me (stripPrefix)
        â”‚
        â–¼
UserService Pod :8002
        â”‚
        â–¼
PostgreSQL â†’ Response
```

### 3. WebSocket (Tiempo Real)

```
Cliente WebSocket
        â”‚
        â–¼
    [WS /ws]
        â”‚
        â–¼
NGINX Ingress (WebSocket support)
        â”‚
        â–¼
NGINX Controller
        â”‚
        â–¼
NotificationService Pod :8082
        â”‚
        â–¼
Maintain Connection
```

## Componentes por Namespace

### Namespace: `musicshare`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Namespace: musicshare                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚ DEPLOYMENTS:                                        â”‚
â”‚ â€¢ frontend (3 replicas)                            â”‚
â”‚ â€¢ userservice (2-6 HPA)                            â”‚
â”‚ â€¢ musicservice (2-6 HPA)                           â”‚
â”‚ â€¢ social-service (2-5 HPA)                         â”‚
â”‚ â€¢ notificationservice (2-6 HPA)                    â”‚
â”‚ â€¢ metadata-service (1 replica)                     â”‚
â”‚                                                     â”‚
â”‚ SERVICES:                                           â”‚
â”‚ â€¢ frontend (ClusterIP:80)                          â”‚
â”‚ â€¢ frontend-loadbalancer (LoadBalancer:80)          â”‚
â”‚ â€¢ userservice (ClusterIP:8002)                     â”‚
â”‚ â€¢ musicservice (ClusterIP:8081)                    â”‚
â”‚ â€¢ social-service (ClusterIP:8083)                  â”‚
â”‚ â€¢ notificationservice (ClusterIP:8082)             â”‚
â”‚ â€¢ metadata-service (ClusterIP:50051)               â”‚
â”‚                                                     â”‚
â”‚ INGRESS:                                            â”‚
â”‚ â€¢ api-gateway (API routing)                        â”‚
â”‚                                                     â”‚
â”‚ STORAGE:                                            â”‚
â”‚ â€¢ postgres-pvc (50GB)                              â”‚
â”‚ â€¢ mongodb-pvc (100GB)                              â”‚
â”‚                                                     â”‚
â”‚ AUTOSCALING:                                        â”‚
â”‚ â€¢ userservice-hpa (2-6, 50% CPU)                   â”‚
â”‚ â€¢ musicservice-hpa (2-6, 50% CPU)                  â”‚
â”‚ â€¢ social-service-hpa (2-5, 55% CPU)               â”‚
â”‚ â€¢ notificationservice-hpa (2-6, 50% CPU)          â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Namespace: `ingress-nginx`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Namespace: ingress-nginx                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚ DEPLOYMENTS:                                        â”‚
â”‚ â€¢ nginx-ingress-controller (2 replicas)            â”‚
â”‚                                                     â”‚
â”‚ SERVICES:                                           â”‚
â”‚ â€¢ nginx-ingress (LoadBalancer:80,443)              â”‚
â”‚ â€¢ nginx-ingress-metrics (ClusterIP:10254)          â”‚
â”‚                                                     â”‚
â”‚ CONFIGMAPS:                                         â”‚
â”‚ â€¢ nginx-configuration                              â”‚
â”‚ â€¢ tcp-services                                     â”‚
â”‚ â€¢ udp-services                                     â”‚
â”‚                                                     â”‚
â”‚ RBAC:                                               â”‚
â”‚ â€¢ ServiceAccount: nginx-ingress                    â”‚
â”‚ â€¢ ClusterRole: nginx-ingress                       â”‚
â”‚ â€¢ ClusterRoleBinding: nginx-ingress                â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Namespace: `ingress-nginx` (RBAC)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   RBAC: nginx-ingress                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                            â”‚
â”‚ Permisos:                                  â”‚
â”‚ â€¢ get, list, watch configmaps              â”‚
â”‚ â€¢ get, list, watch endpoints               â”‚
â”‚ â€¢ get, list, watch nodes                   â”‚
â”‚ â€¢ get, list, watch pods                    â”‚
â”‚ â€¢ get, list, watch secrets                 â”‚
â”‚ â€¢ get, list, watch services                â”‚
â”‚ â€¢ get, list, watch ingresses               â”‚
â”‚ â€¢ get, list, watch ingressclasses          â”‚
â”‚ â€¢ patch services/status                    â”‚
â”‚ â€¢ patch ingresses/status                   â”‚
â”‚ â€¢ create, patch events                     â”‚
â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Ciclo de Vida de una Solicitud

### Solicitud a API (Ejemplo: GET /api/users/me)

```
1. CLIENTE
   â””â”€> Browser/App envÃ­a: GET /api/users/me

2. LOADBALANCER PÃšBLICO
   â””â”€> Recibe en puerto 80
   â””â”€> Distribuye a NGINX pods

3. NGINX INGRESS CONTROLLER
   â””â”€> Revisa Ingress rules
   â””â”€> Encuentra match: /api/users
   â””â”€> Aplica middleware: rewrite-target: /
   â””â”€> Convierte: /api/users/me â†’ /me
   â””â”€> Service lookup: userservice:8002

4. SERVICE DISCOVERY
   â””â”€> userservice (ClusterIP:8002)
   â””â”€> Selecciona pod (2-6 disponibles)
   â””â”€> Load balance entre pods

5. USERSERVICE POD
   â””â”€> Recibe: GET /me (sin /api/users)
   â””â”€> Procesa lÃ³gica de negocio
   â””â”€> Consulta PostgreSQL si necesario

6. POSTGRESQL
   â””â”€> Retorna datos del usuario
   â””â”€> Respuesta a UserService

7. USERSERVICE POD
   â””â”€> Prepara JSON response
   â””â”€> EnvÃ­a 200 OK

8. NGINX
   â””â”€> Recibe response
   â””â”€> AÃ±ade headers (CORS, etc)
   â””â”€> Retorna al cliente

9. CLIENTE
   â””â”€> Recibe JSON con datos del usuario
   â””â”€> UI se actualiza
```

## Escalado AutomÃ¡tico (HPA)

```
MÃ‰TRICAS (cada 15 segundos)
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Prometheus/Metrics     â”‚
â”‚  Server                 â”‚
â”‚                         â”‚
â”‚ CPU Usage:              â”‚
â”‚ â€¢ userservice: 65%      â”‚
â”‚ â€¢ musicservice: 30%     â”‚
â”‚ â€¢ socialservice: 80%    â”‚
â”‚ â€¢ notificationservice: 45%
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HorizontalPodAutoscalerâ”‚
â”‚                         â”‚
â”‚ Compara:                â”‚
â”‚ â€¢ Metric actual vs target
â”‚ â€¢ 80% actual (userservice)
â”‚ â€¢ 50% target              
â”‚ â€¢ Diferencia = +30%       
â”‚                         â”‚
â”‚ Calcula:                â”‚
â”‚ â€¢ Replicas needed       â”‚
â”‚ â€¢ Current: 2            â”‚
â”‚ â€¢ Needed: 5             â”‚
â”‚ â€¢ Action: scale up      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Kubernetes API         â”‚
â”‚  ScaleSubresource       â”‚
â”‚                         â”‚
â”‚ PATCH deployment        â”‚
â”‚ spec.replicas: 2 â†’ 5    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ New Pods Scheduled      â”‚
â”‚                         â”‚
â”‚ Pod 3, Pod 4, Pod 5     â”‚
â”‚ (Creating...)           â”‚
â”‚ (Running...)            â”‚
â”‚ (Ready...)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Load Distributed       â”‚
â”‚                         â”‚
â”‚ â€¢ Pod 1: 20%            â”‚
â”‚ â€¢ Pod 2: 20%            â”‚
â”‚ â€¢ Pod 3: 20%            â”‚
â”‚ â€¢ Pod 4: 20%            â”‚
â”‚ â€¢ Pod 5: 20%            â”‚
â”‚ Average: 20%            â”‚
â”‚ (Target: 50% OK)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Monitoreo y Observabilidad

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          MONITORING STACK                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚ PROMETHEUS (Scraping)                           â”‚
â”‚ â€¢ nginx-ingress:10254/metrics                   â”‚
â”‚ â€¢ kubelet:10250/metrics                         â”‚
â”‚ â€¢ kube-state-metrics:8080/metrics               â”‚
â”‚         â”‚                                       â”‚
â”‚         â–¼                                       â”‚
â”‚ Time Series DB                                  â”‚
â”‚ (Almacena mÃ©tricas)                            â”‚
â”‚         â”‚                                       â”‚
â”‚         â–¼                                       â”‚
â”‚ GRAFANA (VisualizaciÃ³n)                         â”‚
â”‚ â€¢ Dashboard NGINX                               â”‚
â”‚ â€¢ Dashboard Kubernetes                          â”‚
â”‚ â€¢ Dashboard Custom                              â”‚
â”‚         â”‚                                       â”‚
â”‚         â–¼                                       â”‚
â”‚ ALERTMANAGER (Alertas)                         â”‚
â”‚ â€¢ CPU > 80%: Warning                           â”‚
â”‚ â€¢ Memory > 90%: Critical                       â”‚
â”‚ â€¢ Pod Restart: Alert                           â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Certificados y Seguridad

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   cert-manager                  â”‚
â”‚   (HTTPS/TLS Management)        â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ClusterIssuer            â”‚   â”‚
â”‚  â”‚ letsencrypt-prod         â”‚   â”‚
â”‚  â”‚                          â”‚   â”‚
â”‚  â”‚ ContactEmail: admin@...  â”‚   â”‚
â”‚  â”‚ Server: ACME v2          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚             â”‚                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Certificate Resource     â”‚   â”‚
â”‚  â”‚ musicshare-tls           â”‚   â”‚
â”‚  â”‚                          â”‚   â”‚
â”‚  â”‚ Domains:                 â”‚   â”‚
â”‚  â”‚ â€¢ musicshare.com         â”‚   â”‚
â”‚  â”‚ â€¢ api.musicshare.com     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚             â”‚                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Secret (TLS)             â”‚   â”‚
â”‚  â”‚ musicshare-tls           â”‚   â”‚
â”‚  â”‚                          â”‚   â”‚
â”‚  â”‚ â€¢ tls.crt (certificate)  â”‚   â”‚
â”‚  â”‚ â€¢ tls.key (private key)  â”‚   â”‚
â”‚  â”‚ â€¢ ca.crt (chain)         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚             â”‚                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ NGINX Ingress            â”‚   â”‚
â”‚  â”‚ (Utiliza Secret)         â”‚   â”‚
â”‚  â”‚                          â”‚   â”‚
â”‚  â”‚ Termina HTTPS en:        â”‚   â”‚
â”‚  â”‚ - Puerto 443 (externos)  â”‚   â”‚
â”‚  â”‚ - HTTP/2 a servicios     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Este diagrama representa la arquitectura completa y actualizada de MusicShare con NGINX Ingress Controller.**

Para mÃ¡s detalles, ver [DEPLOYMENT_ARCHITECTURE.md](DEPLOYMENT_ARCHITECTURE.md)
